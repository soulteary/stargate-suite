<!DOCTYPE html>
<html lang="{{.Lang}}">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="Generate docker-compose and .env for Stargate, Warden, Herald.">
	<title>{{.Title}}</title>
	<link rel="stylesheet" href="/static/css/pure-min.css">
	<link rel="stylesheet" href="/static/css/grids-responsive-min.css">
	<link rel="preload" href="/static/css/style.css" as="style">
	<link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
	<div class="pure-g content">
		<div class="pure-u-1">
			<header class="page-header pure-g pure-g-r">
				<div class="pure-u-1 pure-u-md-3-4">
					<h1 class="page-title"><span data-i18n="title">{{.Title}}</span></h1>
				</div>
				<div class="pure-u-1 pure-u-md-1-4 lang-switch-wrap">
					<span class="lang-switch"><a href="#" class="pure-link" data-lang="zh" id="lang-zh">中文</a> | <a href="#" class="pure-link" data-lang="en" id="lang-en">English</a></span>
				</div>
			</header>
			<p class="subtitle" data-i18n="subtitle">Select compose type(s) and options, then click Generate.</p>

			<nav class="tab-bar" role="tablist" aria-label="Main tabs" data-i18n-aria-label="tablistAriaLabel">
				<button type="button" class="tab-trigger active" role="tab" aria-selected="true" aria-controls="panel-generate" id="tab-generate" data-tab="generate" data-i18n="tabGenerate">生成部署配置</button>
				<button type="button" class="tab-trigger" role="tab" aria-selected="false" aria-controls="panel-import-parse" id="tab-import-parse" data-tab="import-parse" data-i18n="tabImportParse">导入并解析配置</button>
				<button type="button" class="tab-trigger" role="tab" aria-selected="false" aria-controls="panel-keys" id="tab-keys" data-tab="keys" data-i18n="tabKeys">密钥生成</button>
			</nav>

			<div id="panel-generate" class="tab-panel" role="tabpanel" aria-labelledby="tab-generate">
			<form id="form" class="pure-form pure-form-stacked">
				<!-- 通用配置：单列布局，每项一行 -->
				<div class="config-single-column pure-g">
					<div class="pure-u-1">
				<fieldset class="pure-group compose-type-row">
					<legend data-i18n="composeType">Compose Type</legend>
					{{range .Modes}}
					<div class="config-item pure-control-group" data-env-name="mode">
						<label>
							<input type="checkbox" name="mode" value="{{.Value}}" class="pure-checkbox">
							<span class="config-label" data-i18n="{{.LabelKey}}">{{.LabelKey}}</span>
							<span class="compose-type-desc" data-i18n="{{.DescKey}}"></span>
						</label>
					</div>
					{{end}}
				</fieldset>
				<fieldset class="pure-group config-options-cols">
					<legend data-i18n="configOptions">Options</legend>
					{{range .ConfigSections}}
					<div class="env-group">
						{{if .TitleKey}}<h2 class="section-title" data-i18n="{{.TitleKey}}"></h2>{{end}}
						{{range .Options}}
						{{if eq .Type "checkbox"}}
						<div class="config-item pure-control-group" data-env-name="{{.EnvName}}"{{if .ShowWhenOption}} data-depends-on-option="{{.ShowWhenOption}}"{{end}}>
							<label>
								<input type="checkbox" name="{{.Name}}" id="{{.Id}}" data-option="{{.Id}}" class="pure-checkbox"{{if .Default}} checked{{end}}>
								<span class="config-label" data-i18n="{{.LabelKey}}"></span>
								<span class="config-env">{{.EnvName}}</span>
							</label>
							<p class="config-desc" data-i18n="{{.DescKey}}"></p>
						</div>
						{{else if eq .Type "select"}}
						<div class="config-item pure-control-group" data-env-name="{{.EnvName}}"{{if .ShowWhenOption}} data-depends-on-option="{{.ShowWhenOption}}"{{end}}>
							<label for="{{.Id}}"><span class="config-label" data-i18n="{{.LabelKey}}"></span> <span class="config-env">{{.EnvName}}</span></label>
							<select name="{{.Name}}" id="{{.Id}}" data-option="{{.Id}}" class="pure-input-1">
								{{$def := .Default}}{{range .Options}}
								<option value="{{.Value}}"{{if eq (printf "%v" $def) .Value}} selected{{end}}>{{.Value}}</option>
								{{end}}
							</select>
							<p class="config-desc" data-i18n="{{.DescKey}}"></p>
						</div>
						{{else if eq .Type "text"}}
						<div class="config-item pure-control-group" data-env-name="{{.EnvName}}"{{if .ShowWhenOption}} data-depends-on-option="{{.ShowWhenOption}}"{{end}}>
							<label for="{{.Id}}"><span class="config-label" data-i18n="{{.LabelKey}}"></span> <span class="config-env">{{.EnvName}}</span></label>
							<input type="text" name="{{.Name}}" id="{{.Id}}" data-option="{{.Id}}" class="pure-input-1"{{if .PlaceholderKey}} data-i18n-placeholder="{{.PlaceholderKey}}"{{end}}{{if .Placeholder}} placeholder="{{.Placeholder}}"{{end}}{{if .Default}} value="{{.Default}}"{{end}}>
							<p class="config-desc" data-i18n="{{.DescKey}}"></p>
						</div>
						{{else if eq .Type "number"}}
						<div class="config-item pure-control-group" data-env-name="{{.EnvName}}"{{if .ShowWhenOption}} data-depends-on-option="{{.ShowWhenOption}}"{{end}}>
							<label for="{{.Id}}"><span class="config-label" data-i18n="{{.LabelKey}}"></span> <span class="config-env">{{.EnvName}}</span></label>
							<input type="number" name="{{.Name}}" id="{{.Id}}" data-option="{{.Id}}" class="pure-input-1"{{if .Placeholder}} placeholder="{{.Placeholder}}"{{end}}{{if .Default}} value="{{.Default}}"{{end}}{{if .Min}} min="{{.Min}}"{{end}}{{if .Max}} max="{{.Max}}"{{end}}>
							<p class="config-desc" data-i18n="{{.DescKey}}"></p>
						</div>
						{{else if eq .Type "radio"}}
						<div class="config-item pure-control-group" data-env-name="">
							<label>
								<input type="radio" name="{{.Name}}" id="{{.Id}}" value="{{.Value}}" class="pure-radio"{{if .Default}} checked{{end}}>
								<span class="config-label" data-i18n="{{.LabelKey}}"></span>
							</label>
							<p class="config-desc" data-i18n="{{.DescKey}}"></p>
						</div>
						{{else if eq .Type "redisPaths"}}
						<div id="redisPathInputs" class="redis-paths" style="display:none;">
							{{range .Paths}}
							<div class="config-item pure-control-group" data-env-name="{{.Env}}">
								<label for="{{.Id}}"><span class="config-label" data-i18n="{{.LabelKey}}"></span> <span class="config-env">{{.Env}}</span></label>
								<input type="text" id="{{.Id}}" data-option="{{.Id}}" class="pure-input-1" placeholder="{{.Placeholder}}" value="{{.Default}}">
								<p class="config-desc" data-i18n="{{.DescKey}}"></p>
							</div>
							{{end}}
						</div>
						{{else if eq .Type "imageEnv"}}
						<div class="config-item pure-control-group" data-env-name="{{.EnvName}}"{{if .ShowWhenOption}} data-depends-on-option="{{.ShowWhenOption}}"{{end}}>
							<label for="env_{{.EnvName}}"><span class="config-label" data-i18n="{{.LabelKey}}"></span> <span class="config-env">{{.EnvName}}</span></label>
							<input type="text" id="env_{{.EnvName}}" data-env="{{.EnvName}}" class="pure-input-1"{{if .Placeholder}} placeholder="{{.Placeholder}}"{{end}}{{if .Default}} value="{{.Default}}"{{end}}>
							<p class="config-desc" data-i18n="{{.DescKey}}"></p>
						</div>
						{{end}}
						{{end}}
					</div>
					{{end}}
				</fieldset>
					</div>
				</div>
				<!-- 服务配置：Stargate 单独一列占两行高，Warden/Herald 另一列上下两行 -->
				<fieldset class="pure-group">
					<legend data-i18n="serviceEnv">Service env vars</legend>
					<div class="services-grid">
					{{range $i, $s := .Services}}
					<div class="service-cell {{if eq $i 0}}service-cell-stargate{{else}}service-cell-other{{end}}">
						<details class="pure-details"{{if $s.Open}} open{{end}}>
							<summary class="pure-details-summary"><strong>{{if $s.NameKey}}<span data-i18n="{{$s.NameKey}}"></span>{{else}}{{$s.Name}}{{end}}</strong></summary>
							{{if eq $i 0}}<div class="stargate-cols">{{end}}
							{{range $s.Sections}}
							<div class="env-group">
								{{if .TitleKey}}<h2 class="section-title" data-i18n="{{.TitleKey}}"></h2>{{end}}
								{{range .EnvVars}}
								<div class="config-item pure-control-group" data-env-name="{{.Env}}"{{if .ShowWhenEnv}} data-depends-on-env="{{.ShowWhenEnv}}"{{end}}{{if .ShowWhenOption}} data-depends-on-option="{{.ShowWhenOption}}"{{end}}>
									{{if eq .Type "checkbox"}}
									<label>
										<input type="checkbox" name="envBool" id="env_{{.Env}}" data-env="{{.Env}}" class="pure-checkbox"{{if .Default}} checked{{end}}>
										<span class="config-label" data-i18n="{{.LabelKey}}"></span>
										<span class="config-env">{{.Env}}</span>
									</label>
									{{else}}
									<label for="env_{{.Env}}"><span class="config-label" data-i18n="{{.LabelKey}}"></span> <span class="config-env">{{.Env}}</span></label>
									{{if eq .Type "text"}}
									<input type="text" id="env_{{.Env}}" data-env="{{.Env}}" class="pure-input-1"{{if .Placeholder}} placeholder="{{.Placeholder}}"{{end}}{{if .Default}} value="{{.Default}}"{{end}}>
									{{else if eq .Type "number"}}
									<input type="number" id="env_{{.Env}}" data-env="{{.Env}}" class="pure-input-1"{{if .Placeholder}} placeholder="{{.Placeholder}}"{{end}}{{if .Default}} value="{{.Default}}"{{end}}{{if .Min}} min="{{.Min}}"{{end}}{{if .Max}} max="{{.Max}}"{{end}}>
									{{else if eq .Type "select"}}
									<select id="env_{{.Env}}" data-env="{{.Env}}" class="pure-input-1">
										{{$def := .Default}}{{range .Options}}
										<option value="{{.Value}}"{{if eq (printf "%v" $def) .Value}} selected{{end}}>{{.Value}}</option>
										{{end}}
									</select>
									{{end}}
									{{end}}
									<p class="config-desc" data-i18n="{{.DescKey}}"></p>
								</div>
								{{end}}
							</div>
							{{end}}
							{{if eq $i 0}}</div>{{end}}
						</details>
					</div>
					{{end}}
					</div>
				</fieldset>
				<!-- Provider（Herald 通道）：每类 provider 单独一行展示 -->
				{{if .Providers}}
				<fieldset class="pure-group providers-fieldset">
					<legend data-i18n="providerEnv">Provider (Herald channel)</legend>
					<p class="config-desc providers-desc" data-i18n="providerEnvDesc"></p>
					<div class="providers-rows">
					{{range .Providers}}
					<div class="provider-row"{{if eq .Id "herald-dingtalk"}} data-depends-on-option="dingtalkEnabled"{{else if eq .Id "herald-smtp"}} data-depends-on-option="smtpEnabled"{{else if eq .Id "herald-totp"}} data-depends-on-option="totpEnabled"{{end}}>
						<details class="pure-details"{{if .Open}} open{{end}}>
							<summary class="pure-details-summary"><strong>{{if .NameKey}}<span data-i18n="{{.NameKey}}"></span>{{else}}{{.Name}}{{end}}</strong></summary>
							{{range .Sections}}
							<div class="env-group">
								{{if .TitleKey}}<h2 class="section-title" data-i18n="{{.TitleKey}}"></h2>{{end}}
								{{range .EnvVars}}
								<div class="config-item pure-control-group" data-env-name="{{.Env}}"{{if .ShowWhenEnv}} data-depends-on-env="{{.ShowWhenEnv}}"{{end}}{{if .ShowWhenOption}} data-depends-on-option="{{.ShowWhenOption}}"{{end}}>
									{{if eq .Type "checkbox"}}
									<label>
										<input type="checkbox" name="envBool" id="env_{{.Env}}" data-env="{{.Env}}" class="pure-checkbox"{{if .Default}} checked{{end}}>
										<span class="config-label" data-i18n="{{.LabelKey}}"></span>
										<span class="config-env">{{.Env}}</span>
									</label>
									{{else}}
									<label for="env_{{.Env}}"><span class="config-label" data-i18n="{{.LabelKey}}"></span> <span class="config-env">{{.Env}}</span></label>
									{{if eq .Type "text"}}
									<input type="text" id="env_{{.Env}}" data-env="{{.Env}}" class="pure-input-1"{{if .Placeholder}} placeholder="{{.Placeholder}}"{{end}}{{if .Default}} value="{{.Default}}"{{end}}>
									{{else if eq .Type "number"}}
									<input type="number" id="env_{{.Env}}" data-env="{{.Env}}" class="pure-input-1"{{if .Placeholder}} placeholder="{{.Placeholder}}"{{end}}{{if .Default}} value="{{.Default}}"{{end}}{{if .Min}} min="{{.Min}}"{{end}}{{if .Max}} max="{{.Max}}"{{end}}>
									{{else if eq .Type "select"}}
									<select id="env_{{.Env}}" data-env="{{.Env}}" class="pure-input-1">
										{{$def := .Default}}{{range .Options}}
										<option value="{{.Value}}"{{if eq (printf "%v" $def) .Value}} selected{{end}}>{{.Value}}</option>
										{{end}}
									</select>
									{{end}}
									{{end}}
									<p class="config-desc" data-i18n="{{.DescKey}}"></p>
								</div>
								{{end}}
							</div>
							{{end}}
						</details>
					</div>
					{{end}}
					</div>
				</fieldset>
				{{end}}
				<div class="form-actions">
					<button type="submit" id="btn-generate" class="pure-button pure-button-primary" data-i18n="btnGenerate">Generate</button>
				</div>
			</form>

			<div id="result" class="result-area" role="status" aria-live="polite"></div>
			<div id="downloads" class="downloads pure-menu pure-menu-list" aria-label="Download links"></div>
			<div id="config-preview-wrap" class="config-preview-wrap" style="display:none;" aria-hidden="true">
				<details class="config-preview-details pure-details">
					<summary class="pure-details-summary" data-i18n="previewSummary">预览生成配置</summary>
					<div id="config-preview-content" class="config-preview-content"></div>
				</details>
			</div>
			</div>

			<div id="panel-keys" class="tab-panel" role="tabpanel" aria-labelledby="tab-keys" aria-hidden="true" style="display:none;">
				<p class="keys-desc config-desc" data-i18n="keysDesc">生成适用于「生成部署配置」的各类密钥与 API Key，可复制或一键填入生成配置表单。</p>
				<div class="keys-tool pure-g">
					<div class="pure-u-1 keys-grid" id="keys-grid"></div>
					<div class="pure-u-1 form-actions keys-actions">
						<button type="button" id="btn-generate-all-keys" class="pure-button pure-button-primary" data-i18n="btnGenerateAllKeys">全部重新生成</button>
						<button type="button" id="btn-fill-keys-into-generate" class="pure-button" data-i18n="btnFillKeysIntoGenerate">填入生成配置</button>
					</div>
				</div>
			</div>

			<div id="panel-import-parse" class="tab-panel" role="tabpanel" aria-labelledby="tab-import-parse" aria-hidden="true" style="display:none;">
				<p class="import-parse-desc config-desc" data-i18n="importParseDesc">粘贴 docker-compose.yml 与可选的 .env 内容，点击解析即可查看服务列表与环境变量摘要。</p>
				<div class="import-parse-form pure-form pure-form-stacked">
					<label for="input-compose"><span data-i18n="importComposeLabel">docker-compose.yml</span></label>
					<textarea id="input-compose" class="pure-input-1 parse-textarea" rows="14" data-i18n-placeholder="importComposePlaceholder" placeholder="粘贴 docker-compose 内容（YAML）…"></textarea>
					<details class="import-env-details">
						<summary data-i18n="importEnvSummary">可选：粘贴 .env 内容</summary>
						<textarea id="input-env" class="pure-input-1 parse-textarea" rows="6" data-i18n-placeholder="importEnvPlaceholder" placeholder="KEY=VALUE 每行一条…"></textarea>
					</details>
					<div class="form-actions">
						<button type="button" id="btn-parse" class="pure-button pure-button-primary" data-i18n="btnParse">解析</button>
					</div>
				</div>
				<div id="parse-result" class="parse-result-area" role="status" aria-live="polite"></div>
			</div>
		</div>
	</div>

	<script>window.I18N = {{.I18N}};</script>
	<script src="/static/js/app.js" defer></script>
</body>
</html>
